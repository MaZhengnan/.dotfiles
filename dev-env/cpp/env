#!/bin/bash
set -e

ACTION="$1"
CONTAINER="$2"

# âœ… ä½¿ç”¨éåªè¯»çš„å˜é‡å
export HOST_UID=$(id -u)
export HOST_GID=$(id -g)

echo "ğŸ†” ä½¿ç”¨ UID: $HOST_UID, GID: $HOST_GID"

# å¦‚æœæ²¡ä¼ å®¹å™¨åï¼Œä½¿ç”¨é»˜è®¤
if [[ -z "$CONTAINER" ]]; then
  CONTAINER="cpp-dev"
fi

case "$ACTION" in
  build)
    echo "ğŸ”¨ Building C++ development container..."
    podman-compose build
    ;;
  up)
    echo "ğŸš€ Starting container..."
    podman-compose up -d
    ;;
  down)
    echo "ğŸ›‘ Stopping container..."
    podman-compose down
    ;;
  rebuild)
    echo "â™»ï¸ Rebuilding container..."
    podman-compose down
    podman-compose build
    podman-compose up -d
    ;;
  enter|shell)
    echo "ğŸš Entering container: $CONTAINER"
    podman exec -it "$CONTAINER" bash
    ;;
  logs)
    podman logs "$CONTAINER"
    ;;
  status)
    echo "ğŸ“Š Container status:"
    podman ps -a --filter "name=$CONTAINER"
    ;;
  *)
    cat << EOF
Usage: $0 <command> [container]

Commands:
  build     - æ„å»ºå®¹å™¨é•œåƒ
  up        - å¯åŠ¨å®¹å™¨
  down      - åœæ­¢å®¹å™¨
  rebuild   - é‡æ–°æ„å»ºå¹¶å¯åŠ¨
  enter     - è¿›å…¥å®¹å™¨shell
  logs      - æŸ¥çœ‹å®¹å™¨æ—¥å¿—
  status    - æŸ¥çœ‹å®¹å™¨çŠ¶æ€

å®¹å™¨åé»˜è®¤ä¸º: cpp-dev
EOF
    exit 1
    ;;
esac